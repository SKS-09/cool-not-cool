const KEYWORDS_INCLUDE=['launch','launched','launching','introducing','introduce','now live','rolled out','shipping','release','released','beta','new feature','feature update','v2','v3','update is live','public beta','token','coin','tge','ido','listing','airdrop','token is live','mainnet','on base','onchain','$'];
function looksLikeLaunch(text:string):boolean{const t=(text||'').toLowerCase();return KEYWORDS_INCLUDE.some(k=>t.includes(k));}
function engagementScore(c:any):number{const likes=Number(c?.reactions?.likes_count||c?.likes_count||0);const recasts=Number(c?.reactions?.recasts_count||c?.recasts_count||0);const replies=Number(c?.replies?.count||c?.replies_count||0);return likes+recasts+replies;}
export async function fetchTrendingWithFilter(apiKey:string){let cursor: string|undefined; const picked:any[]=[];
for(let page=0;page<4;page++){const url=new URL('https://api.neynar.com/v2/farcaster/feed/trending');url.searchParams.set('limit','50'); if(cursor) url.searchParams.set('cursor',cursor);
const r=await fetch(url.toString(),{headers:{'api_key':apiKey}}); if(!r.ok) break; const data:any=await r.json(); const casts:any[]=data?.casts||[];
for(const c of casts){const text=c?.text||c?.cast?.text||''; if(!looksLikeLaunch(text)) continue; const embeds=(c?.embeds||c?.attachments||[]).map((e:any)=>({url:e?.url||e?.uri||'',content_type:e?.metadata?.content_type||''})).filter((e:any)=>e.url);
(c as any).__normalized_embeds=embeds; picked.push(c);} cursor=data?.next?.cursor; if(!cursor) break;} picked.sort((a,b)=>engagementScore(b)-engagementScore(a)); return picked;}